import audio from"./audio.mobile.js";import{buildTrack}from"./ui.mobile.js";const jsmediatags=window.jsmediatags,musicArt=document.querySelector("div.music-art"),musicArtImg=document.querySelector("img.music-art-img"),musicTitleSpan=document.querySelector("span#music-title-span"),musicArtistSpan=document.querySelector("span#music-artist-span"),musicResSpan=document.querySelector("span#music-res-span"),musicInputFile=document.querySelector("input#music-input-file"),musicList=document.querySelector("div.music-list");function buildTrackWithInfo(files){musicList.innerHTML="";for(let id=0;id<files.length;id++){const file=files[id];-1!=file.type.indexOf("audio/x-m4a")&&(file=new File([file],file.name.slice(0,file.name.lastIndexOf("."))+".mp4",{type:"audio/mp4"})),jsmediatags.read(file,{onSuccess:async tag=>{try{var data=tag.tags.picture["data"];let base64String="";for(let i=0;i<data.length;i++)base64String+=String.fromCharCode(data[i]);var imgSrc=`data:${data.format};base64,`+window.btoa(base64String),trackTitle=tag.tags.title,trackArtist=tag.tags.artist;buildTrack(file,id,imgSrc,trackTitle,trackArtist)}catch(error){let trackTitle=file.name.slice(0,file.name.lastIndexOf("."));buildTrack(file,id,"assets/music-art-default.webp",trackTitle,"")}},onError:async()=>{var trackTitle=file.name.slice(0,file.name.lastIndexOf("."));buildTrack(file,id,"assets/music-art-default.webp",trackTitle,"")}})}}function showMusicInfo(file){musicTitleSpan.textContent="",musicArtistSpan.textContent="",musicResSpan.textContent="",musicInputFile.value="",jsmediatags.read(file,{onSuccess:function(tag){try{var data=tag.tags.picture["data"];let base64String="";for(let i=0;i<data.length;i++)base64String+=String.fromCharCode(data[i]);musicArtImg.src=`data:${data.format};base64,`+window.btoa(base64String),musicTitleSpan.textContent=tag.tags.title,musicArtistSpan.textContent=tag.tags.artist,musicResSpan.textContent=file.name.slice(file.name.lastIndexOf(".")+1,file.name.length).toUpperCase()}catch(error){musicTitleSpan.textContent=file.name.slice(0,file.name.lastIndexOf(".")),musicResSpan.textContent=file.name.slice(file.name.lastIndexOf(".")+1,file.name.length).toUpperCase(),musicArtImg.src="assets/music-art-default.webp"}},onError:function(error){musicTitleSpan.textContent=file.name.slice(0,file.name.lastIndexOf(".")),musicResSpan.textContent=file.name.slice(file.name.lastIndexOf(".")+1,file.name.length).toUpperCase(),musicArtImg.src="assets/music-art-default.webp"}})}function loadFile(){musicArt.addEventListener("click",()=>{musicInputFile.accept="*",musicInputFile.click()}),musicInputFile.addEventListener("change",()=>{var files=musicInputFile.files;if(1<files.length)buildTrackWithInfo(files);else if(1===files.length){let file=files[0];showMusicInfo(file=-1!=file.type.indexOf("audio/x-m4a")?new File([file],file.name.slice(0,file.name.lastIndexOf("."))+".mp4",{type:"audio/mp4"}):file),audio(file)}})}loadFile();